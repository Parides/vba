{% extends "base.html"%}
{% block title %}Dashboard{% endblock%}
{% block navbar %}
    <!-- SIDE BAR ENTRIES -->
    <li class="zoom nav-item" rel="Dashboard">
        <a class="nav-link" href="#tab-dashboard" data-toggle="pill" aria-selected="true">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-bar-chart-line" viewBox="0 0 16 16">
                <path d="M11 2a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v12h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3h1V7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7h1V2zm1 12h2V2h-2v12zm-3 0V7H7v7h2zm-5 0v-3H2v3h2z"/>
            </svg>
            <span class="ml-2">Dashboard</span>
        </a>
    </li>

    <li class="zoom nav-item" rel="Attendance Records">
        <a class="nav-link" href="#tab-records" data-toggle="pill">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-list-check" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3.854 2.146a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0l-.5-.5a.5.5 0 1 1 .708-.708L2 3.293l1.146-1.147a.5.5 0 0 1 .708 0zm0 4a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0l-.5-.5a.5.5 0 1 1 .708-.708L2 7.293l1.146-1.147a.5.5 0 0 1 .708 0zm0 4a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0l-.5-.5a.5.5 0 0 1 .708-.708l.146.147 1.146-1.147a.5.5 0 0 1 .708 0z"/>
            </svg>
            <span class="ml-2">Attendance Records</span>
        </a>
    </li>

    <li class="zoom nav-item" rel="Your Profile">
        <a class="nav-link" href="#tab-profile" data-toggle="pill">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
            </svg>
            <span class="ml-2">Your Profile</span>
        </a>
    </li>

    <li class="zoom nav-item" rel="Privacy">
        <a class="nav-link" href="#tab-privacy" data-toggle="pill">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-key" viewBox="0 0 16 16">
                <path d="M0 8a4 4 0 0 1 7.465-2H14a.5.5 0 0 1 .354.146l1.5 1.5a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0L13 9.207l-.646.647a.5.5 0 0 1-.708 0L11 9.207l-.646.647a.5.5 0 0 1-.708 0L9 9.207l-.646.647A.5.5 0 0 1 8 10h-.535A4 4 0 0 1 0 8zm4-3a3 3 0 1 0 2.712 4.285A.5.5 0 0 1 7.163 9h.63l.853-.854a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.793-.793-1-1h-6.63a.5.5 0 0 1-.451-.285A3 3 0 0 0 4 5z"/>
                <path d="M4 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
            </svg>
            <span class="ml-2">Privacy</span>
        </a>
    </li>

    <li class="zoom nav-item" rel="Face Recognition">
        <a class="nav-link" href="#tab-facerec" data-toggle="pill">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-upc-scan" viewBox="0 0 16 16">
                <path d="M1.5 1a.5.5 0 0 0-.5.5v3a.5.5 0 0 1-1 0v-3A1.5 1.5 0 0 1 1.5 0h3a.5.5 0 0 1 0 1h-3zM11 .5a.5.5 0 0 1 .5-.5h3A1.5 1.5 0 0 1 16 1.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 1-.5-.5zM.5 11a.5.5 0 0 1 .5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 1 0 1h-3A1.5 1.5 0 0 1 0 14.5v-3a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v3a1.5 1.5 0 0 1-1.5 1.5h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 1 .5-.5zM3 4.5a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-7zm3 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7z"/>
            </svg>
            <span class="ml-2">Face Recognition</span>
        </a>
    </li>
    
{% endblock %}

{% block content %}

    <div class="tab-content" id="tabContent" role="tablist">

        <div class="tab-pane fade show active" name = "Dashboard" id="tab-dashboard" role="tab">
            <div class="card">
                <div class="card-header">
                    <h5 class="h3 mb-0">Attendance Analytics</h5>
                </div>
                <div class="card-body">
                    {% if chart_labels and chart_data %}
                        <canvas id="myChartlol"></canvas>
                    {% endif %}
                    <!-- <script src="{{url_for('static', filename='chart4.js')}}"></script> -->
                </div>
            </div>


            
        </div>

        <div class="tab-pane fade" id="tab-records" name = "Attendance Records" role="tab">
            <div class="row">
                <div class="container-fluid">
                    <div class="row mb-4">
                        {% if attendance_per_module %}
                            {% for row in attendance_per_module %}
                            <div class="zoom col-12 col-md-6 col-lg-3 mb-4 mb-lg-0 my-4">
                                <div class="card">
                                    <h5 class="card-header">{{row[0]}}</h5>
                                    <div class="card-body">
                                        <h5 class="card-title">Attendances</h5>
                                        <p class="card-text">You have attended {{row[2]}} sessions out of {{row[1]}}</p>
                                        {% if row[5] == 1 %}
                                            <p class="card-text text-danger">Attendance Penalty will be applied</p>
                                        
                                        {% else %}
                                            <p class="card-text text-success">{{row[4]}} Absences remaining</p>
                                        {% endif %}
            
                                        
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                    <div class="card">
                        <h5 class="card-header">Attendance records</h5>
                        <div class="card-body">
                            <div class="form-group">
                                <input id="myInput" type="text" class="form-control" placeholder="Search">
                            </div>
                            <div class="table-responsive" id="attendanceTable" style="max-height:250px;overflow: scroll;">
                                <table class="table" style="text-align: center;">
                                    <thead class="thead">
                                        <tr>
                                            <th scope="col">Module</th>
                                            <th scope="col">Session</th>
                                            <th scope="col">Time</th>
                                        </tr>
                                    </thead>
                                    <tbody id="myTable">
                                        {% if attendance %}
                                            {% for row in attendance %}
                                                <tr>

                                                <!-- <th scope="row">1</th> -->
                                                    {% for value in row %}
                                                            <!-- <th scope="row">{{value}}</th> -->
                                                            <td>{{value}}</td>
                                                    {% endfor %}                                            
                                                </tr>
                                            {% endfor %}
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card my-4">
                        <h5 class="card-header">Absenses</h5>
                        <div class="card-body">
                            <div class="form-group">
                                <input id="myInput2" type="text" class="form-control" placeholder="Search">
                            </div>
                            <div class="table-responsive" id="absencesTable" style="max-height:250px;overflow: scroll;">
                                <table class="table" style="text-align: center;">
                                    <thead class="thead">
                                        <tr>
                                            <th scope="col">Session</th>
                                            <th scope="col">User</th>
                                            <th scope="col">Time</th>
                                        </tr>
                                    </thead>
                                    <tbody id="myTable">
                                        {% for row in absences %}
                                            <tr>

                                            <!-- <th scope="row">1</th> -->
                                                {% for value in row %}
                                                        <!-- <th scope="row">{{value}}</th> -->
                                                        <td>{{value}}</td>
                                                {% endfor %}                                            
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>    
                </div>
            </div>

        </div>

        <div class="tab-pane fade" id="tab-profile" name = "Profile" role="tab">
            <div class="row">
                <div class="container-fluid">
                    <form action = "{{ url_for('changepass') }}", method = "POST">
                        <div class="card">
                            <h5 class="card-header">Your details</h5>
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="username">Name</label>
                                        <input type="text" class="form-control" id="inlineFormInputName" placeholder="username" name = "user_name" value = "{{user_name if user_name}}" readonly>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="username">Username</label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <div class="input-group-text">@</div>
                                            </div>
                                            
                                            <input type="text" class="form-control" id="inlineFormInputGroupUsername" placeholder="Username" name="user_id" value= "{{user_id if user_id}}" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-12">
                                        <label for="password"> New Password </label>
                                        <input type="password" class="form-control" name="user_password" placeholder="New Password" minlength="8" maxlength="20" required> 
                                        <small id="passwordHelpInline" class="text-muted">
                                            Must be 8-20 characters long.
                                        </small>                    
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <button type="submit" class="btn btn-outline-success">Submit changes</button>
                                </div>
                                
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="tab-privacy" name = "Privacy" role="tab">

            <div class="row my-4">
                <div class="container-fluid">
                    <form action = "{{ url_for('download_data') }}", method = "POST">
                        <div class="card">
                            <h5 class="card-header">Download your data</h5>
                            <div class="card-body">
                                <div class="form-row">
                                    <!-- <div class="form-group col-md-12">
                                        <label for="email">Enter your email</label>
                                        <input type="email" class="form-control" name="" placeholder="example@email.com" required> 
                                        <small id="passwordHelpInline" class="text-muted"> We only use your email to provide you with your data</small>                    
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <button type="submit" class="btn btn-outline-success">Send my data</button>
                                    <button type="reset" class="btn btn-outline-danger">Reset</button> -->

                                    <!-- <button type="submit" class="btn btn-outline-success">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-cloud-download" viewBox="0 0 16 16">
                                            <path d="M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383z"/>
                                            <path d="M7.646 15.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 14.293V5.5a.5.5 0 0 0-1 0v8.793l-2.146-2.147a.5.5 0 0 0-.708.708l3 3z"/>
                                          </svg>
                                    </button> -->
                                    <p>We value your privacy that's why we allow you to download all your attendance records on a txt file.</p>
                                </div>
                                <div class="form-row">
                                    <button type="submit" class="btn btn-outline-success">Download My Data</button>
                                </div>
                                
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="row">
                <div class="container-fluid">
                    <form action = "{{ url_for('removebio') }}", method = "POST">
                        <div class="card">
                            <h5 class="card-header">Remove your biometric data</h5>
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="username">Name</label>
                                        <input type="text" class="form-control" id="inlineFormInputName" placeholder="username" name = "user_name" value = "{{user_name if user_name}}" readonly>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="username">Username</label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <div class="input-group-text">@</div>
                                            </div>
                                            
                                            <input type="text" class="form-control" id="inlineFormInputGroupUsername" placeholder="Username" name="user_id" value= "{{user_id if user_id}}" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="form">Feedback</label>
                                    <textarea class="form-control" name="user_feedback" placeholder="Please provide us with your feedback" id="floatingTextarea2" style="height: 100px"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <button type="submit" id="deletedata" class="btn btn-outline-danger">Remove Consent</button>
                                    <button type="reset" class="btn btn-outline-success">Reset</button>
                                </div>
                                
                            </div>
                        </div>
                    </form>
                </div>
            </div>


        </div>

        <div class="tab-pane fade " id="tab-facerec" name = "Face Recognition" role="tab">
            <div class="row">
                <div class="container-fluid">
                    <form action = "/upload", onsubmit="return checkForm(this)", method = "POST" enctype=multipart/form-data>
                        <div class="card">
                            <h5 class="card-header">Face readings</h5>
                            <div class="card-body">
                                <h5 class="card-title">Update your face biometrics</h5>
                                <p class="card-text"> 
                                    <!-- <input type="file" class="custom-file-input" accept="video/*"  onchange="selectedVid(this);" name = "upload_file" required>
                                    <label class="custom-file-label" for="customFile">Choose file</label>
                                    <span class="input-group-text">Upload</span> -->
                                    <div class="custom-file">
                                        <input type="file" class="form-control" aria-label="Upload" id="customFile" accept="video/mp4"  onchange="selectedVid(this);" name = "upload_file" required>
                                        <label class="custom-file-label" for="customFile">Upload file</label>
                                    </div>
                                </p>
                                <p class="card-text">
                                    <video width="container-fluid" autoplay id="video" controls style="width:100%; height:100%">
                                        <source id="source" type="video/mp4"></source>
                                    </video>
                                </p>
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="exampleCheck1" name = 'user_biometric_consent' required>
                                    <label class="form-check-label" for="exampleCheck1"> I have read the 
                                        <a data-toggle="modal" data-target="#privacyModal"><u>Privacy Policy</u></a>
                                        and aggree to the 
                                        <a data-toggle="modal" data-target="#tosModal"><u>Terms & Conditions</u></a> to the use of my biometric data
                                    </label>
                                  
                                </div>
                                <p class="card-text">
                                    <button type="submit" class="btn btn-success">Upload Face</button>
                                    <!-- <span></span> -->
                                    <!-- <button type="reset" href="#" class="btn btn-danger">Reset</button> -->
                                    <button type = 'reset' class='btn btn-danger' onClick="window.location.reload();">Reset</button>
                                </p>                                  
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <script>
        $(document).ready(function(){
            $("#myInput").on("keyup", function() {
                var value = $(this).val().toLowerCase();
                $("#myTable tr").filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        });

        document.getElementById("deletedata").addEventListener("click", function(event){
            if(confirm("Are you sure?"))
            {

            }
            else
            {
                event.preventDefault()
            }

        });


        let colors4 = ['rgba(255, 99, 132, 0.4)', 'rgba(54, 162, 235, 0.4)', 'rgba(255, 206, 86, 0.4)', 'rgba(75, 192, 192, 0.4)', 'rgba(153, 102, 255, 0.4)'];
        let bcolors4 = ['rgba(255,99,132,1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)'];
        // define the chart data
        var chartData = {
            labels : [{% for item in chart_labels %}
                        "{{item}}",
                        {% endfor %}],
            datasets : [{
                data : [{% for item in chart_data %}
                            {{item * 100}},
                        {% endfor %}],

                backgroundColor: colors4,
                borderColor: bcolors4,
                borderWidth: 1
            }]
        }

        var options = {
            title: {
                text: "Attendance percentage per module (%)",
                display: true
            },
            scales: {
                yAxes: [{
                    display: true,
                    ticks: {
                        suggestedMin: 0,    // minimum will be 0, unless there is a lower value.
                        suggestedMax: 100,
                        callback: function (value) {
                        return (value / this.max * 100).toFixed(0) + '%'; // convert it to percentage
                        },
                    }
                }]
            },
            legend: {
                display: false
            },
            tooltips: {
                enabled: true
            },

            animation: {
                duration: 2000, //ms
                easing: 'easeInOutQuint'
            }
            
        }
        
        // get chart canvas
        var ctx = document.getElementById("myChartlol").getContext("2d");
        
        // create the chart using the chart canvas
        var myChart = new Chart(ctx, {
        type: 'bar',
        data: chartData,
        options: options
        });

    </script>


{% endblock %}